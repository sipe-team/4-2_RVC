### 금주 리서치 내용

# RVC 모델의 개념

RVC Model은 `Retrieval-based Voice Conversion` Model의 약자로, 음성의 특징을 학습하여 다른 사람의 음성을 학습한 음성으로 변환하는 모델을 의미한다. TTS (`Text To Speech`)는 텍스트를 음성으로 변환하지만, RVC Model은 STS (`Speech To Speech`)가 가능하다는 특징이 있다. RVC Model을 활용하면 아래와 같은 일들을 할 수 있다.

- ***특정 음악의 보컬을 나의 목소리로 교체***
- 유명인의 목소리로 영상 더빙
- 실시간으로 내 목소리를 원하는 인물의 목소리로 변조

# 우리 팀의 목표

우리 팀의 목표는 **“원하는 음악의 보컬을 나의 목소리로 교체”** 하는 것이다. 이 작업을 위해 당연하지만 RVC 모델을 통해 `내 음성을 학습` 시키고, 보컬의 목소리를 `내 목소리로 변환`하는 작업이 필요하다. 이 두 단계를 학습 단계, 추론 단계라고 칭할 수 있다.

- **학습 단계**
    - 내 음성 파일을 AI가 분석하여 목소리의 높낮이, 말투, 발음, 억양, 음색을 분석
    - AI 모델이 이 데이터들을 학습한 후 학습 결과를 `.pth` 파일로 저장

- **추론 단계**
    - ***보컬의 음성만 별도로 분리된 음성 파일을 준비***
    - RVC 모델에 이 음성을 입력하면, 보컬의 발화 내용과 목소리 패턴을 추출
    - 해당 패턴을 내 목소리 학습 결과 (`.pth` 파일)와 매핑하여 변환

# 목표 달성을 위해 준비해야 할 것

RVC 모델은 다행히 이미지 학습 모델과 달리 학습 시간과 리소스가 비교적 적게 든다고 한다. 5-10분 분량의 음성 파일을 학습하는 경우, RTX 3060 그래픽 카드 기준 학습 시간이 약 5-10분 소요된다고 한다. (물론 직접 해봐야 알 것 같음)

## 준비물

- RTX 3060 스펙 이상의 그래픽 카드 (혹은 Colab 리소스)
- 최소 5-10 분 이상의 깨끗한 목소리로 녹음한 학습용 음성 파일
- WAV 48kHz, mono 형태의 `wav` 파일
- 변환을 위한 원곡의 보컬 분리 음성 파일
- 추론 결과를 덮어쓰기 위한 원곡의 MR 파일

## 학습 환경

- RVC v2 Disconnected
    - WebUI와 Gradio없이, 파이썬 코드만으로 학습 작업을 실행시키는 Colab 기반 프로젝트
    - Python을 다뤄보지 않은 사람에게는 다소 불친절할 수 있으며, 기본적으로 추론은 불가능

- **RVC WebUI (추천)**
    - WebUI + Gradio 환경으로 구성된 UI 기반의 학습 / 추론 환경
    - local에서 설치형으로 구동할 수도, Colab에서 구동할 수도 있음

# RVC 모델의 구조

## Metaphore

RVC 모델을 통해 음성을 변조하는 과정은 누군가의 연주 스타일을 Copy하는 과정에 비유할 수 있다. 만약 누군가의 연주 스타일을 Copy하려면 어떤 정보들이 필요할까? 가장 먼저, ***“이 사람이 어떤 곡을 연주했는지”*** 에 해당하는 정보가 필요하다. 즉, `악보`다. 그 다음은 ***“그 사람이 이 악보를 연주할 때 어디서 강하게 연주하고, 어디서 부드럽게 연주하는가?”*** 에 대한 정보다. 즉, `연주 기법`이다. 마지막으로 ***“이 사람은 어떤 악기로 연주하는지”*** 에 대한 정보다.

세 데이터를 바탕으로 그 사람이 연주했던 음성을 반복해서 들어보면 **“이 사람은 이런 악보일 때 보통 이런 식으로 연주하는구나”** 라는 추론이 서게 된다. 이렇게 추론이 정립되면 어떤 악보를 보더라도 ***“이 사람 스타일로 악보를 연주할 수 있게”*** 되는 것이다.

## RVC 모델에 적용

RVC 모델은 크게 `Content Encoder`, `Pitch Extractor`, `Speech embedding`, `Conversion Network`, `Vocoder`, `Retrieval Module` (선택), 여섯 가지 구성 요소로 나눌 수 있다. 이 중 앞에서부터 네 가지 구성 요소는 위 비유에서 아래와 같이 대응된다.

### 데이터 전처리에 필요한 모듈

- `Content Encoder`
    
    언어적 특성 (=악보)를 따는데 필요한 모듈로, 대표적인 음성 모델은 아래와 같다.
    
    - `HuBERT`
        
        Facebook에서 개발, text 없이도 음성 구조를 학습할 수 있다는 특징
        
    - `ContentVec`
        
        BAAI에서 개발, `HuBERT`를 기반으로 파인튜닝된 모델이며, 더 깨끗한 음소 추출이 가능
        
    
- `Pitch Extractor`
    
    음성의 높낮이 (= 연주 기법)을 따는데 필요한 모듈로, 대표적인 음성 모델은 아래와 같다.
    
    - `rmvpe`
        
        RVC에서 공식적으로 제공하는 모델로, 실시간 변환 시에도 활용될 만큼 빠르고 정확함, 별다른 이유가 없다면 가급적 `rmvpe` 모델을 적용하는 것이 좋다.
        
- `Speech Embedding` (다중 화자일 때만 화자 식별을 위해 필요함)
    
    음색 (=어떤 악기로 연주했는지)을 식별하는데 필요한 모듈

### 실제 학습을 수행하는 모듈

- `Conversion Network` = 녹음을 들으며 연주 스타일을 추론하는 모듈

목소리를 학습하기 위해선 두 가지 핵심 정보가 필요하다.

- “무슨 말을 했는지” ***(언어적 특성 = 악보)***
    - 발음, 타이밍, 억양 등의 정보

- “발화의 특성이 어떠한지” ***(화자 특성 = 연주 기법)***
    - 음색, 목소리 톤, 발성 습관, 발화 속도 등의 정보

이 중 “무슨 말을 했는지”에 대한 데이터를 분리하기 위한 모듈이 바로 `Content Encoder`로, 입력된 음성으로에서 “언어적 특성을 가지는 데이터”만 벡터 시퀀스로 변환하는 역할을 한다. 반면 `Pitch Extractor` 와 `Speech Embedding`은 “발화의 특성이 어떠한지”에 대한 데이터를 분리하는 역할을 수행한다.

이렇게 “발화의 내용”, “음높이”, “음색”에 대한 정보가 생성되었다면, `Conversion Network`에서 데이터를 기반으로 음성을 학습, 학습의 결과물인 `.pth` 파일에 저장한다.

```
     [입력 음성]
          ↓
 ┌──────────────────────┬──────────────────────┬──────────────────────┐
 │                      │                      │                      │
 ▼                      ▼                      ▼                      
Content Encoder     Pitch Extractor      Speaker Embedding Extractor
 (내용 추출)          (음높이 추출)           (음색 추출)
      │                     │                      │
      ▼                     ▼                      ▼
 [Content 벡터]       [f₀ (pitch) 벡터]       [speaker embedding]
      └────────────┬───────┬────────────────────┘
                   ▼       ▼
         [Conversion Network / Generator]
           (음색 변환 및 재합성)
```

# RVC V2 WebUI 사용하기

아래 블로그 링크는 RVC V2 WebUI를 활용하여, 음성을 학습하고 추론까지 진행하는 과정이 담겨있다.

[AI음성기술 RVC와 VC Client라는 보이스체인저를 사용해보았다.](https://k66google.tistory.com/838?utm_source=chatgpt.com)

### 차주 계획

- 윈도우 PC에 RVC V2 WebUI 설치
- 음성 학습 테스트
- 음성 추론 테스트
